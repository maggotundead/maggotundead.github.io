$(function() {

        // $(".publicity_page__slider__img__bg").slick({
        //
        //     slidesToShow: 1,
        //     slidesToScroll: 1,
        //     arrows: !0,
        //     fade: !0,
        //     asNavFor: ".publicity_page__slider__preview",
        //     nextArrow: '<button type="button" class="slick-next"></button>'
        //
        // })
        //     $(".publicity_page__slider__preview").slick({
        //     slidesToShow: 5,
        //     slidesToScroll: 1,
        //     arrows: !0,
        //     asNavFor: ".publicity_page__slider__img__bg",
        //     // focusOnSelect: !0,
        //     centerMode: true,
        //     focusOnSelect: false,
        //     useTransform: false,
        //     nextArrow: '<button type="button" class="slick-next"></button>'
        //
        // })
    $('.publicity_page__slider__img__bg').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: false,
        fade: true,
        asNavFor: '.publicity_page__slider__preview'
    });
    $('.publicity_page__slider__preview').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        asNavFor: '.publicity_page__slider__img__bg',
        dots: false,
        centerMode: true,
        focusOnSelect: true
    });
    $('#region_select').change(function() {
       var selected = $(this).val();
       if (selected != 1811){
           $('div#filter_select_kvartira_region').css('display', 'none');
           $('div#filter_select_kvartira_poselok').css('display', 'none');
           $('div#filter_select_kvartira_metro').css('display', 'none');
       }else {
           $('div#filter_select_kvartira_region').css('display', 'block');
           $('div#filter_select_kvartira_poselok').css('display', 'block');
           $('div#filter_select_kvartira_metro').css('display', 'block');
       }
    });

    }),

    function(e) {

        "function" == typeof define && define.amd ? define(["jquery"], e) : e("object" == typeof exports ? require("jquery") : jQuery)

    }(function(e) {

        var t, n = navigator.userAgent,

            i = /iphone/i.test(n),

            a = /chrome/i.test(n),

            _ = /android/i.test(n);

        e.mask = {

            definitions: {

                9: "[0-9]",

                a: "[A-Za-z]",

                "*": "[A-Za-z0-9]"

            },

            autoclear: !0,

            dataName: "rawMaskFn",

            placeholder: "_"

        }, e.fn.extend({

            caret: function(e, t) {

                var n;

                if (0 !== this.length && !this.is(":hidden") && this.get(0) === document.activeElement) return "number" == typeof e ? (t = "number" == typeof t ? t : e, this.each(function() {

                    this.setSelectionRange ? this.setSelectionRange(e, t) : this.createTextRange && (n = this.createTextRange(), n.collapse(!0), n.moveEnd("character", t), n.moveStart("character", e), n.select())

                })) : (this[0].setSelectionRange ? (e = this[0].selectionStart, t = this[0].selectionEnd) : document.selection && document.selection.createRange && (n = document.selection.createRange(), e = 0 - n.duplicate().moveStart("character", -1e5), t = e + n.text.length), {

                    begin: e,

                    end: t

                })

            },

            unmask: function() {

                return this.trigger("unmask")

            },

            mask: function(n, o) {

                var c, s, r, l, d, u, h, p;

                if (!n && this.length > 0) {

                    c = e(this[0]);

                    var f = c.data(e.mask.dataName);

                    return f ? f() : void 0

                }

                return o = e.extend({

                    autoclear: e.mask.autoclear,

                    placeholder: e.mask.placeholder,

                    completed: null

                }, o), s = e.mask.definitions, r = [], l = h = n.length, d = null, n = String(n), e.each(n.split(""), function(e, t) {

                    "?" == t ? (h--, l = e) : s[t] ? (r.push(new RegExp(s[t])), null === d && (d = r.length - 1), e < l && (u = r.length - 1)) : r.push(null)

                }), this.trigger("unmask").each(function() {

                    function c() {

                        if (o.completed) {

                            for (var e = d; e <= u; e++)

                                if (r[e] && x[e] === f(e)) return;

                            o.completed.call(D)

                        }

                    }



                    function f(e) {

                        return e < o.placeholder.length ? o.placeholder.charAt(e) : o.placeholder.charAt(0)

                    }



                    function m(e) {

                        for (; ++e < h && !r[e];);

                        return e

                    }



                    function g(e) {

                        for (; --e >= 0 && !r[e];);

                        return e

                    }



                    function $(e, t) {

                        var n, i;

                        if (!(e < 0)) {

                            for (n = e, i = m(t); n < h; n++)

                                if (r[n]) {

                                    if (!(i < h && r[n].test(x[i]))) break;

                                    x[n] = x[i], x[i] = f(i), i = m(i)

                                } T(), D.caret(Math.max(d, e))

                        }

                    }



                    function v(e) {

                        var t, n, i, a;

                        for (t = e, n = f(e); t < h; t++)

                            if (r[t]) {

                                if (i = m(t), a = x[t], x[t] = n, !(i < h && r[i].test(a))) break;

                                n = a

                            }

                    }



                    function b(e) {

                        var t = D.val(),

                            n = D.caret();

                        if (p && p.length && p.length > t.length) {

                            for (S(!0); n.begin > 0 && !r[n.begin - 1];) n.begin--;

                            if (0 === n.begin)

                                for (; n.begin < d && !r[n.begin];) n.begin++;

                            D.caret(n.begin, n.begin)

                        } else {

                            var i = (S(!0), t.charAt(n.begin));

                            n.begin < h && (r[n.begin] ? r[n.begin].test(i) && n.begin++ : (n.begin++, r[n.begin].test(i) && n.begin++)), D.caret(n.begin, n.begin)

                        }

                        c()

                    }



                    function y(e) {

                        S(), D.val() != W && D.change()

                    }



                    function k(e) {

                        if (!D.prop("readonly")) {

                            var t, n, a, _ = e.which || e.keyCode;

                            p = D.val(), 8 === _ || 46 === _ || i && 127 === _ ? (t = D.caret(), n = t.begin, a = t.end, a - n == 0 && (n = 46 !== _ ? g(n) : a = m(n - 1), a = 46 === _ ? m(a) : a), C(n, a), $(n, a - 1), e.preventDefault()) : 13 === _ ? y.call(this, e) : 27 === _ && (D.val(W), D.caret(0, S()), e.preventDefault())

                        }

                    }



                    function w(t) {

                        if (!D.prop("readonly")) {

                            var n, i, a, o = t.which || t.keyCode,

                                s = D.caret();

                            if (!(t.ctrlKey || t.altKey || t.metaKey || o < 32) && o && 13 !== o) {

                                if (s.end - s.begin != 0 && (C(s.begin, s.end), $(s.begin, s.end - 1)), (n = m(s.begin - 1)) < h && (i = String.fromCharCode(o), r[n].test(i))) {

                                    if (v(n), x[n] = i, T(), a = m(n), _) {

                                        var l = function() {

                                            e.proxy(e.fn.caret, D, a)()

                                        };

                                        setTimeout(l, 0)

                                    } else D.caret(a);

                                    s.begin <= u && c()

                                }

                                t.preventDefault()

                            }

                        }

                    }



                    function C(e, t) {

                        var n;

                        for (n = e; n < t && n < h; n++) r[n] && (x[n] = f(n))

                    }



                    function T() {

                        D.val(x.join(""))

                    }



                    function S(e) {

                        var t, n, i, a = D.val(),

                            _ = -1;

                        for (t = 0, i = 0; t < h; t++)

                            if (r[t]) {

                                for (x[t] = f(t); i++ < a.length;)

                                    if (n = a.charAt(i - 1), r[t].test(n)) {

                                        x[t] = n, _ = t;

                                        break

                                    } if (i > a.length) {

                                    C(t + 1, h);

                                    break

                                }

                            } else x[t] === a.charAt(i) && i++, t < l && (_ = t);

                        return e ? T() : _ + 1 < l ? o.autoclear || x.join("") === A ? (D.val() && D.val(""), C(0, h)) : T() : (T(), D.val(D.val().substring(0, _ + 1))), l ? t : d

                    }

                    var D = e(this),

                        x = e.map(n.split(""), function(e, t) {

                            if ("?" != e) return s[e] ? f(t) : e

                        }),

                        A = x.join(""),

                        W = D.val();

                    D.data(e.mask.dataName, function() {

                        return e.map(x, function(e, t) {

                            return r[t] && e != f(t) ? e : null

                        }).join("")

                    }), D.one("unmask", function() {

                        D.off(".mask").removeData(e.mask.dataName)

                    }).on("focus.mask", function() {

                        if (!D.prop("readonly")) {

                            clearTimeout(t);

                            var e;

                            W = D.val(), e = S(), t = setTimeout(function() {

                                D.get(0) === document.activeElement && (T(), e == n.replace("?", "").length ? D.caret(0, e) : D.caret(e))

                            }, 10)

                        }

                    }).on("blur.mask", y).on("keydown.mask", k).on("keypress.mask", w).on("input.mask paste.mask", function() {

                        D.prop("readonly") || setTimeout(function() {

                            var e = S(!0);

                            D.caret(e), c()

                        }, 0)

                    }), a && _ && D.off("input.mask").on("input.mask", b), S()

                })

            }

        })

    }), $(function() {

        var e = $(".header_nav__popup");

        $(".header_nav__button").click(function() {

            e.removeClass("menuHide"), e.addClass("menuShow"), setTimeout(function() {

                $("body").css({

                    overflow: "hidden"

                })

            }, 300), e.css({

                display: "flex"

            })

        }), $(".header_nav__popup__close").click(function() {

            e.removeClass("menuShow"), e.addClass("menuHide"), $("body").css({

                overflowY: "visible"

            }), setTimeout(function() {

                e.hide()

            }, 300)

        }), $(".heart").click(function(e) {

            e.preventDefault(), e.stopPropagation(), $(this).toggleClass("favorite")

        })

    }), $(function() {

        $(".header_search__location__popup").hide(), $(".header_search__location").click(function(e) {

            e.preventDefault(), $(".header_search__location__popup").fadeToggle()

        }), $("body").click(function(e) {

            $(event.target).closest(".header_search__location").length || $(".header_search__location__popup").fadeOut(), $(event.target).closest(".header_search__rubric").length || $(event.target).closest(".header_search__rubric__drop_down").length || $(".header_search__rubric__drop_down").slideUp(300), $(event.target).closest(".input__select").length || $(".input__select__content").fadeOut(), !$(event.target).closest(".header_search__input").length && !$(event.target).closest(".header_search .btn--blue").length && $(window).outerWidth() < 768 && $(".header_search__input").fadeOut()

        }), $(".btn--show").click(function(e) {

            e.preventDefault(), $(".info__content").slideToggle(800), $(this).toggleClass("btn--show--active")

        }), $("#link--show").click(function(e) {

            e.preventDefault(), $(".publicity_page__bottom__left p span").fadeToggle(800)

        }), $(".new_publicity__rules").click(function(e) {

            $(window).outerWidth() < 615 && ($(".new_publicity__rules p").slideToggle(), $(this).toggleClass("new_publicity__rules--active"))

        }), $(window).resize(function() {

            $(window).outerWidth() > 615 && $(".new_publicity__rules p").show(), $(window).outerWidth() > 768 ? $(".header_search__input").fadeIn() : $(".header_search__input").hide()

        }), $("#phone").mask("(999) 999-9999"), $(".header_search .btn--blue").on('click', function(e) {

            $(window).outerWidth() < 768 && (e.preventDefault(), $(".header_search__input").fadeIn())

        })

    }), $(function() {

        $(window).scroll(function() {

            $(this).scrollTop() > 200 ? $("#btn__scroll").fadeIn() : $(this).scrollTop() < 200 && $("#btn__scroll").fadeOut()

        }), $("#btn__scroll").click(function(e) {

            e.preventDefault(), $("html, body").animate({

                scrollTop: 0

            }, 800)

        })

    }), $(function() {

        var e = $(".header_search");

        e.find(".input__select").on('click', function(o) { 

		//console.log(o.target);

		if (o.target == this || $(o.target).is('p') || $(o.target).is('span')){ 

			if($(this).find(".input__select__content").css("display") == "none"){ console.log('show');

				e.find(".input__select__content").hide();

				$(this).find(".input__select__content").fadeIn(300);

			}

			else{ console.log('hide');

				$(this).parent().find(".input__select__content").fadeOut(300);

			}

		}

		else return;

		

        }), e.find(".input__select .input__select__content a").click(function(e) { //console.log('click to active');

            e.preventDefault();

            var t = $(this).html(),

                n = $(this).closest(".input__select").find("p span");

            $(this).closest(".input__select").addClass("input__select--active"), n.html(t), $(this).closest(".input__select__content").fadeOut();

            var i = $(this); 

            $(this).closest(".input__select").find(".input__select__clean").click(function(e) {

                e.stopPropagation(), n.html(""), i.closest(".input__select").removeClass("input__select--active");

            })

        }), e.find(".input__select .input__select__content input").keyup(function(t) {

            var n = $(this).closest(".input__select__content").find("input").eq(0).val(),

                i = $(this).closest(".input__select__content").find("input").eq(1).val();

            t.preventDefault();

            var a = ($(this).val(), $(this).closest(".input__select").find("p span"));

            $(this).closest(".input__select").addClass("input__select--active"), "" == n && "" == i ? $(this).closest(".input__select").removeClass("input__select--active") : "" == i ? a.html("min. " + n) : "" == n ? a.html("max. " + i) : "" != n && "" != i && a.html(n + " - " + i);

            var _ = $(this);

            $(this).closest(".input__select").find(".input__select__clean").click(function(t) {

                t.stopPropagation(), a.html(""), _.closest(".input__select__content").find("input").eq(1).val(""), _.closest(".input__select__content").find("input").eq(0).val(""), _.closest(".input__select").removeClass("input__select--active"), e.find(".input__select__content").fadeOut()

            })

        }), e.find("#rubric_clear").click(function(t) {

            t.stopPropagation(), t.preventDefault(), e.removeClass("header_search--active")

        })

    }), $(function() {

        var e, t = !1;

        $(".btn_mobile").click(function(e) {

            e.preventDefault(), $("body").addClass("mobile_version"), t = !0

        }), $(".main__category__block").click(function(n) {

            void 0 === $(this).data("target") || "" === $(this).data("target") ? console.log("link") : t || (null == e && (e = this), n.preventDefault(), this != e && $(this).parent(".main__center__category__section").data("section") == $(e).parent(".main__center__category__section").data("section") && "none" == $(".main__center__category").find("#" + $(e).data("target")).css("display") ? ($(".main__category__block").removeClass("main__category__block--opened"), $(this).addClass("main__category__block--opened"), $(".main__center__category").find(".main__center__category__subsection").slideUp(), $(".main__center__category").find("#" + $(this).data("target")).slideDown(), e = this) : this != e && $(this).parent(".main__center__category__section").data("section") == $(e).parent(".main__center__category__section").data("section") ? ($(".main__category__block").removeClass("main__category__block--opened"), $(this).addClass("main__category__block--opened"), $(".main__center__category").find(".main__center__category__subsection").fadeOut(0), $(".main__center__category").find("#" + $(this).data("target")).fadeIn(300), e = this) : this != e && $(this).data("target") != $(e).data("target") ? ($(".main__category__block").removeClass("main__category__block--opened"), $(this).addClass("main__category__block--opened"), $(".main__center__category").find(".main__center__category__subsection").slideUp(), $(".main__center__category").find("#" + $(this).data("target")).slideDown(), e = this) : this == e && "block" == $(".main__center__category").find("#" + $(this).data("target")).css("display") ? ($(".main__category__block").removeClass("main__category__block--opened"), $(".main__center__category").find(".main__center__category__subsection").slideUp()) : this == e && "none" == $(".main__center__category__subsection").css("display") && ($(".main__center__category").find(".main__center__category__subsection").slideUp(), $(".main__center__category").find("#" + $(this).data("target")).slideDown(), $(this).addClass("main__category__block--opened")))

        });

        var n = 1;

        $(".main__category__block").click(function(e) {

            void 0 === $(this).data("target") || "" === $(this).data("target") ? console.log("link") : t && (e.preventDefault(), 1 == n && (n = 2, $(".main__center__category__inside").removeClass("menuShow"), setTimeout(function() {

                $(".main__center__category__inside").addClass("menuShow"), $(".main__center__category").addClass("main__center__category--active")

            }, 50), setTimeout(function() {

                $(".main__center__category__inside").show()

            }, 100)))

        }), $("#category__back").click(function(e) {

            e.preventDefault(), 1 == n ? ($(".main__center__category").removeClass("menuShow"), $(".main__center__category").addClass("menuHide"), setTimeout(function() {

                $(".main__center__category").hide()

            }, 300), n = 1, $("body").css({

                overflowY: "visible"

            })) : 2 == n && ($(".main__center__category").removeClass("main__center__category--active"), $(".main__center__category__inside").removeClass("menuShow"), $(".main__center__category__inside").hide(), $(".main__center__category__section").addClass("menuShow"), n = 1)

        }), $(".header_search__rubric").click(function() {

            t && (n = 1, $(".main__center__category").removeClass("menuHide"), $(".main__center__category").addClass("menuShow"), $(".main__center__category").show(), setTimeout(function() {

                $("body").css({

                    overflow: "hidden"

                })

            }, 300)), window.outerWidth > 800 && !t && $(".header_search__rubric__drop_down").slideToggle(300)

        }), $(".main__center__category__wrap").click(function() {

            $(".main__center__category").removeClass("menuShow"), $(".main__center__category").addClass("menuHide"), setTimeout(function() {

                $(".main__center__category").hide()

            }, 300), $("body").css({

                overflowY: "visible"

            })

        }), $(".header_nav__popup__wrap").click(function() {

            $(".header_nav__popup").removeClass("menuShow"), $(".header_nav__popup").addClass("menuHide"), setTimeout(function() {

                $(".header_nav__popup").hide()

            }, 300), $("body").css({

                overflowY: "visible"

            })

        }), "mobile_version" == $("body").attr("class") && (t = !0), $(window).outerWidth() >= 769 && "mobile_version" != $("body").attr("class") && (t = !1, $(".main_page .main__center__category").show(), $(".main__center__category").removeClass("main__center__category--active"), $("body").css({

            overflowY: "visible"

        })), $(window).outerWidth() < 769 && "mobile_version" != $("body").attr("class") && (t = !0, $(".main__center__category").find(".main__center__category__subsection").hide(), $(".main__category__block").removeClass("main__category__block--opened")), $(window).resize(function() {

            "mobile_version" == $("body").attr("class") && (t = !0), $(window).outerWidth() < 769 && "mobile_version" != $("body").attr("class") && (t = !0, $(".main__center__category").find(".main__center__category__subsection").hide(), $(".main__category__block").removeClass("main__category__block--opened"), $(".main__center__category").hide()), $(window).outerWidth() >= 769 && "mobile_version" != $("body").attr("class") && (t = !1, $("body").css({

                overflowY: "visible"

            }), $(".main_page .main__center__category").show(), $(".main__center__category").removeClass("main__center__category--active"))

        })

    });

	

	

	/*new code*/

	/*$(window).on('load', function(){

		$('.header_search__extra .block-filt li a').on('click', function(){ console.log('click a');

			$(this).attr('data-active','active');

		});

	});*/

	

	$(document).on('click ready', '.header_search__extra .input__select li a',function(){//set choosen value in select filter for form

		$(this).closest('.filt').find('input.hidden').remove();

		console.log('click filter select', $(this).text());

		var opt_text = $(this).text();

		$(this).closest('.input__select').find('input[type=hidden]').val($(this).attr('data-id'));

		$(this).closest('.input__select').find('input[type=hidden]').attr('data-name', $(this).text());

		var opt_title = $(this).closest('.input__select').find('input[type=hidden]').attr('name');

		opt_title = opt_title.split('[filter]');

		opt_title = opt_title[1].slice(1, -1);

		console.log(opt_title);

		$(this).closest('.input__select').find('input[type=hidden]').after('<input type="text" class="hidden" name="'+opt_title+'" value="'+opt_text+'">');

	});

	

	

	

	/*зависимые фильтры-> марка-модель регион-посёлок и т.д.*/

	var id_avto_marka_par = '#filter_select_legkovie_marka li a';

	var id_avto_model_d = '#filter_select_legkovie_model .input__select__content li a';

	var id_kvartira_region_par = '#filter_select_kvartira_region li a';

	var id_kvartira_poselok_d = '#filter_select_kvartira_poselok .input__select__content li a';

	var id_kvartira_poselok_par = '#filter_select_kvartira_poselok li a';

	var id_kvartira_metro_d = '#filter_select_kvartira_metro .input__select__content li a';

	var id_odejda_v_tip_par = '#filter_select_odejda_v_tip li a';

	var id_odejda_v_for_d = '#filter_select_odejda_v_for .input__select__content li a';

	var id_odejda_tip_par = '#filter_select_odejda_tip li a';

	var id_odejda_for_d = '#filter_select_odejda_for .input__select__content li a';

	/*$(document).on('click', id_avto_marka_par+','+id_kvartira_region_par+','+id_kvartira_poselok_par+','+id_odejda_v_tip_par+','+id_odejda_tip_par,function(){

		$(id_avto_model_d+','+id_kvartira_poselok_d+','+id_kvartira_metro_d+','+id_odejda_v_for_d+','+id_odejda_for_d).each(function(){

			$(this).show();

		});

		var id_parent = $(this).attr('data-id');

		console.log('click selector id=', $(this).attr('data-id'));

		console.log('click selector daughter id=', $(this).attr('data-id'));

		$(id_avto_model_d+','+id_kvartira_poselok_d+','+id_kvartira_metro_d+','+id_odejda_v_for_d+','+id_odejda_for_d).each(function(){

			if($(this).attr('data-parent-id')== id_parent){ console.log($(this).text());

				$(this).show();

			}

		});

		

		$(id_avto_model_d+','+id_kvartira_poselok_d+','+id_kvartira_metro_d+','+id_odejda_v_for_d+','+id_odejda_for_d).each(function(){

			if($(this).attr('data-parent-id')!= id_parent){

				$(this).hide();

			}

		});

	});*/

	//changing in filter

	$(document).on('click', id_avto_marka_par+','+id_kvartira_region_par+','+id_kvartira_poselok_par+','+id_odejda_v_tip_par+','+id_odejda_tip_par,function(){ console.log('changing category');

		var select_id = $(this).closest('.filt').attr('id'); console.log('select clicked=',select_id); //id of selector

		var select_input_val = $(this).closest('.filt').find('input[type=hidden]').val(); //value of selected

		$(this).closest('.block-filter').find('.filt').each(function(){

			var parent_id_name = $(this).attr('data-parent-name');

			if(typeof parent_id_name !== typeof undefined && parent_id_name !== false){

				if(select_id == parent_id_name){ console.log(parent_id_name);

					$(this).find('ul li').each(function(){//console.log($(this).find('a').text());

						if($(this).find('a').attr('data-parent-id') == select_input_val) {

							$(this).show();

							$(this).find('a').show();

						}

						// else $(this).find('a').hide();

					});

				}

			}

		});

		

		

		

		if(typeof $('select#record_id option').val() != 'undefined' && $('select#record_id option').val() != '0'){//console.log('category not empty ',$('select#record_id option').val());

			var ch_cat = $('select#record_id').val();

			$('.header_search__extra .block-filter').each(function(){

				if($(this).attr('data-id') == ch_cat){

					$(this).find('.filt').each(function(){//console.log($(this).attr('id'));

						var parent_id_name = $(this).attr('data-parent-name');

						if($(this).hasClass('input__select--active')){

							if (typeof parent_id_name !== typeof undefined && parent_id_name !== false) {

								var parent_id = $('.header_search__extra .block-filter').find('#'+parent_id_name).find('input[type=hidden]').val();

								//console.log(parent_id);

								$(this).find('ul li').each(function(){

									if($(this).find('a').attr('data-parent-id') != parent_id) { //console.log($(this).find('a').text(),' hide');

										$(this).hide();

									}

									else{ //console.log($(this).find('a').text(),' show');

										$(this).find('a').show();

									}

								});

							}

						}

					});					

				}

			});

		}

	});

	



	$(window).on('load',function(){console.log('window load for edit record'); //display filter selector if edit record

		if(typeof $('select#category-dropdown option').val() != 'undefined' && $('select#record_id option').val() != '0'){console.log('category not empty ',$('select#category-dropdown option').val());

			var ch_cat = $('select#category-dropdown').val();

			$('.header_search__extra .block-filter').each(function(){

				if($(this).attr('data-id') == ch_cat){

					$(this).css('display','block');

					$(this).find('.filt').each(function(){ //console.log('filter loop ',$(this).find('input[type=hidden]').attr('name'));//autoselect chosen option value and set

						var sel_val = $(this).find('input[type=hidden]').val(); //console.log('sel_val=',sel_val);

						$(this).find('ul li').each(function(){

							if($(this).find('a').attr('data-id')==sel_val){

								$(this).closest('.filt').addClass('input__select--active');

								

								//console.log($(this).find('a').text(),' parent-id=',sel_val);

								$(this).closest('.filt').find('span').text($(this).find('a').text());

								

								

								var opt_text = $(this).closest('.filt').find('p span').text(); console.log(opt_text);

								var opt_title = $(this).closest('.filt').find('input[type=hidden]').attr('name');

								opt_title = opt_title.split('[filter]');

								opt_title = opt_title[1].slice(1, -1);

								console.log(opt_title);

								$(this).closest('.filt').find('input[type=hidden]').after('<input type="text" class="hidden" name="'+opt_title+'" value="'+opt_text+'">');

								

								

								$(id_avto_model_d+','+id_kvartira_poselok_d+','+id_kvartira_metro_d+','+id_odejda_v_for_d+','+id_odejda_for_d).each(function(){

									if($(this).attr('data-parent-id')!= sel_val){ //if($(this).attr('data-id')=='1')console.log('hide ',$(this).text());

										$(this).hide();

									}

									//else{console.log('show '); $(this).show();}

								});

							}

						});

					});

				}

			});

		}

	});



	$(window).on('load',function(){console.log('window load for edit record'); //display filter selector if edit record

		if(typeof $('select#category-dropdown option').val() != 'undefined' && $('select#category-dropdown option').val() != '0'){console.log('category not empty ',$('select#record_id option').val());

			var ch_cat = $('select#category-dropdown').val();

			$('.header_search__extra .block-filter').each(function(){

				if($(this).attr('data-id') == ch_cat){

					$(this).find('.filt').each(function(){//console.log($(this).attr('id'));

						var parent_id_name = $(this).attr('data-parent-name');

						if($(this).hasClass('input__select--active')){

							if (typeof parent_id_name !== typeof undefined && parent_id_name !== false) {

								var parent_id = $('.header_search__extra .block-filter').find('#'+parent_id_name).find('input[type=hidden]').val();

								//console.log(parent_id);

								$(this).find('ul li').each(function(){

									if($(this).find('a').attr('data-parent-id') != parent_id) { //console.log($(this).find('a').text(),' hide');

										$(this).hide();

									}

									else{ //console.log($(this).find('a').text(),' show');

										$(this).find('a').show();

									}

								});

							}

						}

					});					

				}

			});

		}

	});

	

	//does not working - must be deleted

	/*$(document).ready(function(){//set title for choosen options of filter(for header in advertisment)

		$('.header_search__extra .block-filter').each(function(){

			$(this).find('.filt').each(function(){ //console.log('active filter');

			//if($(this).hasClass('input__select')) console.log('select filter');

				if($(this).hasClass('input__select--active')){

					//console.log('click filter select', $(this).text());

					var opt_text = $(this).find('p span').text(); console.log(opt_text);

					//$(this).closest('.input__select').find('input[type=hidden]').val($(this).attr('data-id'));

					//$(this).closest('.input__select').find('input[type=hidden]').attr('data-name', $(this).text());

					var opt_title = $(this).find('input[type=hidden]').attr('name');

					opt_title = opt_title.split('[filter]');

					opt_title = opt_title[1].slice(1, -1);

					console.log(opt_title);

					$(this).closest('.input__select').find('input[type=hidden]').after('<input type="text" class="hidden" name="'+opt_title+'" value="'+opt_text+'">');

				}

			});

		});

	});*/

	

	

	$(document).ready(function(){//actions for shop

		upload_prod();

		$('.product .item .rem_prod:not(".empty")').on('click', function(){ console.log('remove product'); //remove product

			var prod_id = $(this).closest('.item').attr('data-id'); console.log('prod id=',prod_id);

			var confirm_delete = confirm("Удалить товар безвозвратно?");

			if(confirm_delete){

				$.ajax({

					type: "post",

					url: "/shop/remove?id="+prod_id,

					data: {id: prod_id},

					async: false,

					success: function(data) {

						//result = data;

						console.log(data);

					},

					error: function( jqXHR, status, errorThrown ){ // функция ошибки ответа сервера

						console.log( 'ОШИБКА AJAX запроса delete: ' + status, jqXHR, errorThrown);

					}				

				});

				$(this).closest('.item').remove();

			}

		});

		$('#add_prod').on('click', function(){//add new product

			var record_id = $(".product .item:last .img_val").attr('name');

			record_id = record_id.replace('shop[','');

			record_id = record_id.split(']')[0];

			console.log(record_id);

			var count_i = parseInt($('.product .item').length) + 1;

			$('.product .item.empty').clone().removeClass('empty').insertAfter(".product .item:last");

			$(".product .item:last .img_val").attr('name','shop['+record_id+']['+count_i+'][img_prod]');

			$(".product .item:last textarea").attr('name','shop['+record_id+']['+count_i+'][descr_prod]');

			upload_prod();

			

			$('.product .item .rem_prod.empty').on('click', function(){ console.log('remove product'); //remove product

			//var prod_id = $(this).closest('.item').attr('data-id'); console.log('prod id=',prod_id);

			var confirm_delete = confirm("Удалить товар безвозвратно?");

			if(confirm_delete){

				$(this).closest('.item').remove();

			}

		});

		});

		

		if($('.is_shop input').prop('checked')) $('.product').show(); //show product block if is shop

		else $('.product').hide();

		

		$('.is_shop input').on('change', function(){ //show product block on click if is shop

			if($('.is_shop input').prop('checked')) $('.product').show();

			else $('.product').hide();

		});

		

		

	}); 

		

	

function upload_prod(){

	var prod_photo;

	var img_name;

		$('.product_photo').on('change', function(){//add photo

			prod_photo = this.files;

			$(this).closest('.item').find('.prod_thumb img').attr('src','/php_func/img/'+this.files[0].name);

			$(this).closest('.photo').find('.but_upl_ph').css('border','1px solid #fb0505');

			img_name = this.files[0].name;

			console.log(img_name);

		});

		

		// обработка и отправка AJAX запроса при клике на кнопку upload_files

		$('.but_upl_ph').on( 'click', function( event ){//upload photo

			var click_button = $(this); 

			console.log('click upl');

			event.stopPropagation(); // остановка всех текущих JS событий

			event.preventDefault();  // остановка дефолтного события для текущего элемента - клик для <a> тега



			if( typeof prod_photo == 'undefined' ) return; // ничего не делаем если files пустой

			

			var data = new FormData(); // создадим объект данных формы



			$.each( prod_photo, function( key, value ){ // заполняем объект данных файлами в подходящем для отправки формате

				data.append( key, value );

			});



			data.append( 'my_file_upload', 1 ); // добавим переменную для идентификации запроса

			$.ajax({

				url         : '/php_func/upload_prod.php',

				type        : 'POST', // важно!

				data        : data,

				cache       : false,

				dataType    : 'json', // отключаем обработку передаваемых данных, пусть передаются как есть

				processData : false,

				contentType : false, // отключаем установку заголовка типа запроса. Так jQuery скажет серверу что это строковой запрос

				success     : function( respond, status, jqXHR ){ // функция успешного ответа сервера

					if( typeof respond.error === 'undefined' ){ // ОК - файлы загружены

						var files_path = respond.prod_photo; // выведем пути загруженных файлов в блок '.ajax-reply'

						var html = '';

						$.each( files_path, function( key, val ){

							 html += val +'<br>';

						} )

						//console.log(click_button.closest('.photo').html());

						click_button.closest('.photo').find('.img_val').val(respond.files[0].split('php_func/img/')[1]);

						click_button.css('border','1px solid #fff');

						$('.ajax-reply').html( html );

					}

					else { // ошибка

						click_button.after('ошибка загрузки');

						console.log('ОШИБКА: ' + respond.error );

					}

				},

				error: function( jqXHR, status, errorThrown ){ // функция ошибки ответа сервера

					click_button.after('ошибка ajax запроса');

					console.log( 'ОШИБКА AJAX запроса: ' + status, jqXHR );

					console.log( 'Текст ошибки: ' + errorThrown );

				}

			});

			console.log(img_name);

			var testt = '111';

			

		});

}	

	



	

	//function show_all_models()

	/*$(document).on('click', '.header_search__extra .input__select#filter_select_kvartira_region li a',function(){//set choosen value in select filter for form

		$('#filter_select_legkovie_model .input__select__content li a').each(function(){

			if($(this).attr('data-parent-id')!= id_parent){

				$(this).show();

			}

		});

		console.log('click selector id=', $(this).attr('data-id'));

		var id_parent = $(this).attr('data-id');

		$('#filter_select_legkovie_model .input__select__content li a').each(function(){

			if($(this).attr('data-parent-id')!= id_parent){

				$(this).hide();

			}

		});

	});*/

	

$(document).ready(function(){

	$('#pay-tarif').on('click',function(){

		var confrim_pay = confirm("Подтвердите покупку");

		var user_id = $('#buy_data .user_id').text();

		var tarif = $('#buy_data .tarif').text();

		var adv_id = $('#buy_data .adv_id').text();

		var price = $('#buy_data .price').text();

		if(confrim_pay){ console.log('yes get package');

			$.ajax({

				type: "post",

				url: "/user-buy/buy-tarif",

				data: {user_id: user_id, tarif: tarif, adv_id: adv_id, price: price},

				async: false,

				success: function() {

					//result = data;

					console.log('result');

				} 

			});

		}

		else console.log('no get package');

	});

	

	$('#for-login-block').load('/site/login #login-form', function(){

		$('#for-login-block form').on('submit', function(e) {

			e.preventDefault();

			$.ajax({

				type: "POST",

				url: '/site/login',

				data: $(this).serialize(),

				success: function(data){

					if ($(data).find('.help-block').text().length>0) {

						$('#for-login-block form .field-loginform-username .help-block').text($(data).find('.help-block').text());

					}

					else {

						location.reload();

					}  

			   }

			});

		});

	});

	

	$('.prod_thumb .rotate').on('click', function(){ //rotate img of product

		//$(this).closest('.item').find('.photo input[name=rotate_img]');

		var img = $(this).closest('.prod_thumb').find('img');

		if($(img).hasClass('rot-90')) {

			$(img).addClass('rot-180');

			$(img).removeClass('rot-90');

		}

		else if($(img).hasClass('rot-180')) {

			$(img).addClass('rot-270');

			$(img).removeClass('rot-180');

		}

		else if($(img).hasClass('rot-270')) {

			//$(img).addClass('rot-0');

			$(img).removeClass('rot-270');

		}

		else{

			$(img).addClass('rot-90');

		}



	});

	

	$('.adver_img .rotate').on('click', function(){ //rotate img of advertisment

		if($(this).closest('.all-wrap').find('label').css('background-image') != 'none'){

			var img = $(this).closest('.all-wrap').find('label');

			if($(img).hasClass('rot-90')) {

				$(img).addClass('rot-180');

				$(img).removeClass('rot-90');

				$(img).attr('data-rot','180');

			}

			else if($(img).hasClass('rot-180')) {

				$(img).addClass('rot-270');

				$(img).removeClass('rot-180');

				$(img).attr('data-rot','270');

			}

			else if($(img).hasClass('rot-270')) {

				//$(img).addClass('rot-0');

				$(img).removeClass('rot-270');

				$(img).attr('data-rot','');

			}

			else{

				$(img).addClass('rot-90');

				$(img).attr('data-rot','90');

			}

		}



	});

	

});



$(document).ready(function(){

	$('#lost-pass').on('click',function(){

		alert('Пароль отправлен, проверьте почту');

		//window.history.pushState("object or string", "Title", "/site/lost?redirect=login");

	});

	

	$(document).on('change', '.user_page__main__center [type="checkbox"]', function(){

		console.log('to del check');

		var check_counter = 0;

		/*$('.user_page__main__center [type="checkbox"]').each(function(){

			if(this.)

		});*/

		if($('.user_page__main__center [type="checkbox"]:checked').length > 0)

			$('.mass_ad_options').addClass('visible');

		else $('.mass_ad_options').removeClass('visible');

	});

	

	$(document).on('click','#mass_remove',function(e){

        e.preventDefault();

        //var check = $(this).attr('data-js-confirm');

        var id = [];

        $('.user_page__main__center [type="checkbox"]:checked').each(function(){ console.log(this.value);

            id.push(this.value);

        });

        var data = {

            id,

        };

        data[window.csrf.param] = window.csrf.value;

        if(!id.length) return;

        //var confirm = prompt(`Действие необратимо! Введите "${check}" (без кавычек) если вы действительно хотите удалить записи с ID: `+id.join(', '));

        var conf = confirm("Удалить выбранные?");

		if(conf == true){ 

			$.post('/record/remove',data,function(res){

			});

			$('#user_page').load(document.URL +  ' #user_page');

			//location.reload();

		}

    });

	

	

	if($('#search_filter input[name=category]').val() == '2023'){

		console.log('Rabota');

		$('.filter .price_filt').hide();

	}

});















	

	

	